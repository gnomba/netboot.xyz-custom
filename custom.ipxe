#!ipxe
###
### netboot.xyz-custom menu
###

# background
set vPICTURE http://boot.ipxe.org/ipxe.png
console --x 1280 --y 1024
console --picture ${vPICTURE}

# mirror variables
set vMIRROR mirror.yandex.ru
set vCUSTOM_MIRROR 185.228.233.185

:custom
clear custom_choice
menu gnomba's bootloader

item --gap Clonezilla
item clonezilla_ubuntu ${space} 20191024-eoan (Ubuntu-based)
item clonezilla_debian ${space} 2.6.4-10 (Debian-based)

item --gap Memtest
item memtest83 ${space} MemTest86 8.3 (only UEFI boot) (IMG)
item memtest437 ${space} MemTest86 4.3.7 (IMG)
item memtest501 ${space} Memtest86+ 5.01 (ISO)
item memtest420 ${space} Memtest86+ 4.20 (ISO)

item custom_archlinux ArchLinux
item custom_centos CentOS
item custom_debian Debian
item custom_fedora Fedora
item custom_gentoo Gentoo
item custom_gparted GParted Live
item custom_opensuse OpenSUSE
item custom_systemrescuecd SystemRescueCD
item custom_ubuntu Ubuntu

item --gap Other boot
item netbootxyz ${space} netboot.xyz NETWORK BOOT
item sals ${space} SAL's NETWORK BOOT

choose custom_choice || goto custom_exit
echo ${cls}
#iseq ${custom_choice} netbootxyz && goto netbootxyz
#iseq ${custom_choice} sals && goto sals
goto custom_menu
goto custom_exit

:clonezilla_ubuntu
set vRELEASE 20191024-eoan
goto clonezilla

:clonezilla_debian
set vRELEASE 2.6.4-10
goto clonezilla

:clonezilla
set vNAME clonezilla
set vARCH amd64
set vTYPE iso
set vIMGFILE http://${vCUSTOM_MIRROR}/${custom_choice}/${vNAME}-live-${vRELEASE}-${vARCH}.iso
goto ${vTYPE}_boot

:memtest83
set vRELEASE 8.3
set vTYPE img
goto memtest

:memtest437
set vRELEASE 4.3.7
set vTYPE img
goto memtest

:memtest501
set vRELEASE 5.01
set vTYPE iso
goto memtest

:memtest420
set vRELEASE 4.20
set vTYPE iso
goto memtest

:memtest
set vNAME memtest
set vIMGFILE http://${vCUSTOM_MIRROR}/${vNAME}/${custom_choice}.${vTYPE}
goto ${vTYPE}_boot

:custom_menu
chain ${custom_choice}.ipxe || goto debug

:os_install
echo Booting ${vNAME} ${vRELEASE} ${vARCH}
echo =================
imgfree
imgtrust --allow
kernel ${vKERNEL} ${vOPTS}
isset ${vGENTOO} && initrd ${vURL}/image.squashfs
initrd ${vINITRD}
boot || goto debug

:iso_boot
echo Booting iso-file ${vNAME} ${vRELEASE} ${vARCH}
echo =================
imgfree
imgtrust --allow
initrd ${vIMGFILE}
chain memdisk vmalloc=512M iso raw
boot || goto debug

:img_boot
echo Booting img-file ${vNAME} ${vRELEASE} ${vARCH}
echo =================
imgfree
imgtrust --allow
initrd ${vIMGFILE}
chain memdisk vmalloc=16M raw
boot || goto debug

:netbootxyz
set conn_type https chain --autofree https://boot.netboot.xyz/menu.ipxe || echo HTTPS failed... attempting HTTP...
set conn_type http chain --autofree http://boot.netboot.xyz/menu.ipxe || echo HTTP failed, localbooting... exit 
goto custom

:sals
chain http://boot.salstar.sk || goto custom

:debug
echo +-------+
echo | DEBUG |
echo +-------+
echo custom_choice = ${custom_choice}
echo vMIRROR = ${vMIRROR}
echo vCUSTOM_MIRROR = ${vCUSTOM_MIRROR}
echo =========
goto error

:error
echo +-------+
echo | ERROR |
echo +-------+
echo Error occured, press any key to return to menu ...
prompt
chain custom.ipxe

:custom_exit
goto netbootxyz
exit
